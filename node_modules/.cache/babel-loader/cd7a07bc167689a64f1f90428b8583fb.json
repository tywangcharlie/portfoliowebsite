{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar Canvas_1 = require(\"./Canvas\");\n\nvar EventListeners_1 = require(\"../Utils/EventListeners\");\n\nvar Particles_1 = require(\"./Particles\");\n\nvar Retina_1 = require(\"./Retina\");\n\nvar FrameManager_1 = require(\"./FrameManager\");\n\nvar Options_1 = require(\"../Options/Classes/Options\");\n\nvar Plugins_1 = require(\"../Utils/Plugins\");\n\nvar SimplexNoise_1 = require(\"../Utils/SimplexNoise\");\n\nvar Container = function () {\n  function Container(id, params) {\n    var presets = [];\n\n    for (var _i = 2; _i < arguments.length; _i++) {\n      presets[_i - 2] = arguments[_i];\n    }\n\n    this.started = false;\n    this.destroyed = false;\n    this.id = id;\n    this.paused = true;\n    this.sourceOptions = params;\n    this.lastFrameTime = 0;\n    this.pageHidden = false;\n    this.retina = new Retina_1.Retina(this);\n    this.canvas = new Canvas_1.Canvas(this);\n    this.particles = new Particles_1.Particles(this);\n    this.drawer = new FrameManager_1.FrameManager(this);\n    this.interactivity = {\n      mouse: {}\n    };\n    this.bubble = {};\n    this.repulse = {\n      particles: []\n    };\n    this.plugins = {};\n    this.drawers = {};\n    this.density = 1;\n    this.options = new Options_1.Options();\n\n    for (var _a = 0, presets_1 = presets; _a < presets_1.length; _a++) {\n      var preset = presets_1[_a];\n      this.options.load(Plugins_1.Plugins.getPreset(preset));\n    }\n\n    for (var _b = 0, _c = Plugins_1.Plugins.getSupportedShapes(); _b < _c.length; _b++) {\n      var type = _c[_b];\n      this.drawers[type] = Plugins_1.Plugins.getShapeDrawer(type);\n    }\n\n    if (this.sourceOptions) {\n      this.options.load(this.sourceOptions);\n    }\n\n    this.simplex = new SimplexNoise_1.SimplexNoise();\n    this.eventListeners = new EventListeners_1.EventListeners(this);\n  }\n\n  Container.requestFrame = function (callback) {\n    return window.customRequestAnimationFrame(callback);\n  };\n\n  Container.cancelAnimation = function (handle) {\n    window.cancelAnimationFrame(handle);\n  };\n\n  Container.prototype.play = function (force) {\n    var needsUpdate = this.paused || force;\n\n    if (this.paused) {\n      this.paused = false;\n    }\n\n    if (needsUpdate) {\n      for (var id in this.plugins) {\n        var plugin = this.plugins[id];\n\n        if (plugin.play) {\n          plugin.play();\n        }\n      }\n\n      this.lastFrameTime = performance.now();\n    }\n\n    this.draw();\n  };\n\n  Container.prototype.pause = function () {\n    if (this.drawAnimationFrame !== undefined) {\n      Container.cancelAnimation(this.drawAnimationFrame);\n      delete this.drawAnimationFrame;\n    }\n\n    if (!this.paused) {\n      for (var id in this.plugins) {\n        var plugin = this.plugins[id];\n\n        if (plugin.pause) {\n          plugin.pause();\n        }\n      }\n\n      if (!this.pageHidden) {\n        this.paused = true;\n      }\n    }\n  };\n\n  Container.prototype.draw = function () {\n    var _this = this;\n\n    this.drawAnimationFrame = Container.requestFrame(function (t) {\n      return _this.drawer.nextFrame(t);\n    });\n  };\n\n  Container.prototype.getAnimationStatus = function () {\n    return !this.paused;\n  };\n\n  Container.prototype.densityAutoParticles = function () {\n    this.initDensityFactor();\n    var numberOptions = this.options.particles.number;\n    var optParticlesNumber = numberOptions.value;\n    var optParticlesLimit = numberOptions.limit > 0 ? numberOptions.limit : optParticlesNumber;\n    var particlesNumber = Math.min(optParticlesNumber, optParticlesLimit) * this.density;\n    var particlesCount = this.particles.count;\n\n    if (particlesCount < particlesNumber) {\n      this.particles.push(Math.abs(particlesNumber - particlesCount));\n    } else if (particlesCount > particlesNumber) {\n      this.particles.removeQuantity(particlesCount - particlesNumber);\n    }\n  };\n\n  Container.prototype.initDensityFactor = function () {\n    var densityOptions = this.options.particles.number.density;\n\n    if (!this.canvas.element || !densityOptions.enable) {\n      return;\n    }\n\n    var canvas = this.canvas.element;\n    var pxRatio = this.retina.pixelRatio;\n    this.density = canvas.width * canvas.height / (densityOptions.factor * pxRatio * densityOptions.area);\n  };\n\n  Container.prototype.destroy = function () {\n    this.stop();\n    this.retina.reset();\n    this.canvas.destroy();\n    delete this.interactivity;\n    delete this.options;\n    delete this.retina;\n    delete this.canvas;\n    delete this.particles;\n    delete this.bubble;\n    delete this.repulse;\n    delete this.drawer;\n    delete this.eventListeners;\n\n    for (var type in this.drawers) {\n      var drawer = this.drawers[type];\n\n      if (drawer.destroy !== undefined) {\n        drawer.destroy(this);\n      }\n    }\n\n    this.drawers = {};\n    this.destroyed = true;\n  };\n\n  Container.prototype.exportImg = function (callback) {\n    this.exportImage(callback);\n  };\n\n  Container.prototype.exportImage = function (callback, type, quality) {\n    var _a;\n\n    return (_a = this.canvas.element) === null || _a === void 0 ? void 0 : _a.toBlob(callback, type !== null && type !== void 0 ? type : \"image/png\", quality);\n  };\n\n  Container.prototype.exportConfiguration = function () {\n    return JSON.stringify(this.options, undefined, 2);\n  };\n\n  Container.prototype.refresh = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      return tslib_1.__generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            this.stop();\n            return [4, this.start()];\n\n          case 1:\n            _a.sent();\n\n            return [2];\n        }\n      });\n    });\n  };\n\n  Container.prototype.stop = function () {\n    if (!this.started) {\n      return;\n    }\n\n    this.started = false;\n    this.eventListeners.removeListeners();\n    this.pause();\n    this.particles.clear();\n    this.retina.reset();\n    this.canvas.clear();\n\n    for (var id in this.plugins) {\n      var plugin = this.plugins[id];\n\n      if (plugin.stop !== undefined) {\n        plugin.stop();\n      }\n    }\n\n    this.plugins = {};\n    delete this.particles.lineLinkedColor;\n  };\n\n  Container.prototype.start = function () {\n    return tslib_1.__awaiter(this, void 0, void 0, function () {\n      var availablePlugins, id, _a, _b, _i, id, plugin, _c, _d, _e, type, drawer;\n\n      return tslib_1.__generator(this, function (_f) {\n        switch (_f.label) {\n          case 0:\n            if (this.started) {\n              return [2];\n            }\n\n            availablePlugins = Plugins_1.Plugins.getAvailablePlugins(this);\n\n            for (id in availablePlugins) {\n              this.plugins[id] = availablePlugins[id];\n            }\n\n            this.started = true;\n            this.eventListeners.addListeners();\n            _a = [];\n\n            for (_b in this.plugins) _a.push(_b);\n\n            _i = 0;\n            _f.label = 1;\n\n          case 1:\n            if (!(_i < _a.length)) return [3, 5];\n            id = _a[_i];\n            plugin = this.plugins[id];\n            if (!(plugin.startAsync !== undefined)) return [3, 3];\n            return [4, plugin.startAsync()];\n\n          case 2:\n            _f.sent();\n\n            return [3, 4];\n\n          case 3:\n            if (plugin.start !== undefined) {\n              plugin.start();\n            }\n\n            _f.label = 4;\n\n          case 4:\n            _i++;\n            return [3, 1];\n\n          case 5:\n            _c = [];\n\n            for (_d in this.drawers) _c.push(_d);\n\n            _e = 0;\n            _f.label = 6;\n\n          case 6:\n            if (!(_e < _c.length)) return [3, 9];\n            type = _c[_e];\n            drawer = this.drawers[type];\n            if (!(drawer.init !== undefined)) return [3, 8];\n            return [4, drawer.init(this)];\n\n          case 7:\n            _f.sent();\n\n            _f.label = 8;\n\n          case 8:\n            _e++;\n            return [3, 6];\n\n          case 9:\n            this.init();\n            this.play();\n            return [2];\n        }\n      });\n    });\n  };\n\n  Container.prototype.init = function () {\n    this.retina.init();\n    this.canvas.init();\n    this.particles.init();\n    this.densityAutoParticles();\n\n    for (var id in this.plugins) {\n      var plugin = this.plugins[id];\n\n      if (plugin.init !== undefined) {\n        plugin.init();\n      }\n    }\n  };\n\n  return Container;\n}();\n\nexports.Container = Container;","map":null,"metadata":{},"sourceType":"script"}